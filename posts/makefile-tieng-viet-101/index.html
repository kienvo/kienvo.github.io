<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.1" /><meta property="og:title" content="Makefile tiếng Việt" /><meta property="og:locale" content="en" /><meta name="description" content="Cách sử dụng Makefile" /><meta property="og:description" content="Cách sử dụng Makefile" /><link rel="canonical" href="https://www.kienlab.com/posts/makefile-tieng-viet-101/" /><meta property="og:url" content="https://www.kienlab.com/posts/makefile-tieng-viet-101/" /><meta property="og:site_name" content="Kien’s Lab" /><meta property="og:image" content="https://www.kienlab.com/assets/makefile-tieng-viet/build-order.svg" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-09-03T15:00:00+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://www.kienlab.com/assets/makefile-tieng-viet/build-order.svg" /><meta property="twitter:title" content="Makefile tiếng Việt" /><meta name="twitter:site" content="@keinlab" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-09-03T15:35:05+08:00","datePublished":"2022-09-03T15:00:00+08:00","description":"Cách sử dụng Makefile","headline":"Makefile tiếng Việt","image":"https://www.kienlab.com/assets/makefile-tieng-viet/build-order.svg","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.kienlab.com/posts/makefile-tieng-viet-101/"},"url":"https://www.kienlab.com/posts/makefile-tieng-viet-101/"}</script><title>Makefile tiếng Việt | Kien's Lab</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Kien's Lab"><meta name="application-name" content="Kien's Lab"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/favicons/android-chrome-512x512.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Kien's Lab</a></div><div class="site-subtitle font-italic">Thích thì chế một cái mà xài ! Hardware/Software and other stuff.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/kienvo" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/keinlab" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['nhungzzyxx0010','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Makefile tiếng Việt</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Makefile tiếng Việt</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/username">kienvo</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1662188400" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-09-03 </em> </span> <span> Updated <em class="timeago" data-ts="1662190505" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-09-03 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3723 words"> <em>20 min</em> read</span></div></div></div><div class="post-content"><h2 id="introduction"><span class="mr-2">Introduction</span><a href="#introduction" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Thứ đưa tôi đến với Makefile là <code class="language-plaintext highlighter-rouge">OSdev</code>. Với tuổi trẻ bồng bột, nghĩ mình có thể build 1 hệ điều hành from scratch (thật ra là có thể). Tôi bỏ dở hệ điều hành của mình khi nó vừa đọc xong bàn phím và ghi lên màn hình :)).</p><p>Trước khi đến với <code class="language-plaintext highlighter-rouge">OSdev</code> tôi đã làm việc với một số MCU <code class="language-plaintext highlighter-rouge">8051</code> và <code class="language-plaintext highlighter-rouge">AVR</code>. Xài Keil C (crack - điều hiển nhiên nếu ở VN) để biên dịch cho <code class="language-plaintext highlighter-rouge">8051</code>, xài <code class="language-plaintext highlighter-rouge">AVR Studio</code> rồi đến <code class="language-plaintext highlighter-rouge">Atmel Studio </code>(sau là <code class="language-plaintext highlighter-rouge">Microchip Studio</code>) cho <code class="language-plaintext highlighter-rouge">AVR</code>. Vì tôi cảm thấy vô cùng tội lỗi khi xài đồ crack nên không lâu sau chuyển hoàn toàn sang dùng AVR với <code class="language-plaintext highlighter-rouge">Atmel Studio</code> :)). Tất nhiên là 8051 có <code class="language-plaintext highlighter-rouge">SDCC</code> nhưng tối lúc đó “chưa đủ tuổi” để xài <code class="language-plaintext highlighter-rouge">SDCC</code> (xời, tuổi gì xài SDCC :D).</p><p><code class="language-plaintext highlighter-rouge">Atmel Studio</code> vỏ <code class="language-plaintext highlighter-rouge">Visual Studio</code>, ruột <code class="language-plaintext highlighter-rouge">Eclispe</code>, lõi <code class="language-plaintext highlighter-rouge">avr-gcc</code>. Sau khi trở về từ <code class="language-plaintext highlighter-rouge">OSdev</code> tôi có thể tự mình config các build flag cho <code class="language-plaintext highlighter-rouge">toolchain</code> trong <code class="language-plaintext highlighter-rouge">Eclipse</code> của <code class="language-plaintext highlighter-rouge">Atmel Studio</code>, đặc biệt là macro <code class="language-plaintext highlighter-rouge">F_CPU</code>. Thề, <code class="language-plaintext highlighter-rouge">F_CPU</code> đặt trong <code class="language-plaintext highlighter-rouge">main.c</code> đeo’ bao giờ mà build ra nhận giá trị đúng. Bởi, <code class="language-plaintext highlighter-rouge">F_CPU</code> cần phải đặt là <em>global macro</em> thì tất cả các file <code class="language-plaintext highlighter-rouge">.c</code> <code class="language-plaintext highlighter-rouge">.h</code> mới nhận được giá trị đúng. Đến khi tôi tìm được flag <code class="language-plaintext highlighter-rouge">-D</code> của <code class="language-plaintext highlighter-rouge">gcc</code> thì mọi chuyện được giải quyết. Từ lúc đó tôi vẫn sử dụng toolchain config (Project properties) để config <code class="language-plaintext highlighter-rouge">F_CPU</code> cho project của mình, cho tới khi tìm được chân ái của cuộc đời mình là <code class="language-plaintext highlighter-rouge">Makefile</code>.</p><h2 id="sơ-lược-gcc-toolchain-và-quá-tình-biên-dịch-và-liên-kết"><span class="mr-2">Sơ lược gcc, toolchain và quá tình biên dịch và liên kết</span><a href="#sơ-lược-gcc-toolchain-và-quá-tình-biên-dịch-và-liên-kết" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>GCC là một trình biên dịch của GNU, hỗ trợ nhiều nền tảng khác nhau từ phần cứng cho tới hệ điều hành. Với phần cứng, dễ thấy nhất là <code class="language-plaintext highlighter-rouge">arm-none-eabi-gcc</code> hay dùng lập trình cho STM32, hay <code class="language-plaintext highlighter-rouge">avr-gcc</code> cho AVR, với các SoC ARM chạy linux ta có <code class="language-plaintext highlighter-rouge">arm-linux-gnueabihf-gcc</code>,… GCC là thành phần chính của <code class="language-plaintext highlighter-rouge">GNU toolchain</code>, là trình biên dịch chuẩn cho hầu hết các dự án của GNU và cả Linux.</p><p><code class="language-plaintext highlighter-rouge">Toolchain</code> là một tập hợp các công cụ để tạo ra phần mềm. Một công cụ lấy input từ công cụ trước đó để tạo ra output, output này trở thành input cho công cụ tiếp theo, tạo thành một chuỗi (chain). Các thành phần trong <code class="language-plaintext highlighter-rouge">GNU toolchain</code>:</p><ul><li>GNU make: công cu quản lí và tự động hóa quá trình build<li>GCC: trình biên dịch<li>glibc: thư viện gồm: header file, thư viện, loader<li>GNU binutils: tập hợp các công cụ gồm: linker, assembler,…<li>GNU Bison: trình phân tích cú pháp<li>GNU m4: trình xử li macro<li>GDB: trình gỡ lỗi<li>GNU Libtool: công cụ thư viên động.</ul><p>Biên dịch và liên kết một file thực thi:</p><p><img data-src="/assets/makefile-tieng-viet/build-order.svg" alt="quá trình biên dịch và liên kết một file thuc thi" style="filter: invert(100%);" data-proofer-ignore></p><p>Trong ảnh trên tôi đã lược bỏ đi quá trình preprocess và assembly vì trong bài này tôi không tập trung vào quá trình biên dịch file C. Các file <code class="language-plaintext highlighter-rouge">.c</code> sẽ được biên dịch thành các file <code class="language-plaintext highlighter-rouge">.o</code>, sau đó các file này được liên kết với một số thư viện (etc. glibc) và thêm vào một số phần code startup (etc. crt.a).</p><h2 id="mục-tiêu"><span class="mr-2">Mục tiêu</span><a href="#mục-tiêu" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Trong giai đoạn nghiên cứu và phát triển đam mê, tôi quen rất nhiều người bạn, những người có khả năng lập trình nhưng vẫn sử dụng IDE, một số người bày tỏ mong muốn tìm hiểm về Makefile nhưng</p><ul><li>không có thời gian,<li>không tìm được tài liệu chất lượng (tiếng Việt),<li>không đủ trình độ nghiên cứu tài liệu tiếng Anh cho một vấn đề cụ thể.</ul><p>Tôi mong muốn viết bài này cho mọi người cùng học hỏi và để tra lại khi cần thiết. Vì kiến thức tích lũy bao năm qua, tôi sợ một ngày nào đó mình sẽ quên dần đi. Tôi định viết bài này rất lâu rồi nhưng vì <code class="language-plaintext highlighter-rouge">lười</code>. Tranh thủ kì hè năm 2 rảnh rỗi ngồi viết dần, để tích lũy bài viết lên blog.</p><h2 id="vấn-đề"><span class="mr-2">Vấn đề</span><a href="#vấn-đề" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Khi viết bài này, tôi hay vấp phải vần đề <code class="language-plaintext highlighter-rouge">trứng hay gà</code>, bởi vì kiến thức tôi trình bày trong một phần yêu cầu kiến thức trong phần khác và ngược lại. Tôi giả sử bạn có bootstrap kiến thức của một trong 2 phần đó .Tôi sẽ trình bày theo hướng bottom-up, đó là đi từ vấn đề cốt lõi tại sao sinh ra <code class="language-plaintext highlighter-rouge">Makefile</code>.</p><h3 id="đặt-vấn-đề"><span class="mr-2">Đặt vấn đề</span><a href="#đặt-vấn-đề" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Giả sử, khi lập trình, với C, bạn có thể code mọi thứ trên 1 file .c, nhưng sẽ khó khăn khi maintain</p><ul><li>Một file .c hàng chục nghìn dòng tốn thời gian để build hơn 1 file có ít dòng.<li>Chỉ cần sửa 1 lỗi nhỏ nhưng phải build lại toàn bộ file.<li>Quá trình maintain lại muốn sử dụng thư viện ngoài, <code class="language-plaintext highlighter-rouge">.h</code> <code class="language-plaintext highlighter-rouge">.c</code></ul><h3 id="hướng-giải-quyết"><span class="mr-2">Hướng giải quyết</span><a href="#hướng-giải-quyết" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Có 1 cách giải quyết đó là chia file <code class="language-plaintext highlighter-rouge">main.c</code> thành các file <code class="language-plaintext highlighter-rouge">.c</code>, rồi build các file <code class="language-plaintext highlighter-rouge">.c</code> thành <code class="language-plaintext highlighter-rouge">.o</code>. Việc này có thể thực hiện dễ dàng bằng <code class="language-plaintext highlighter-rouge">shell script</code>.</p><p>Giả sử tôi có 3 file <code class="language-plaintext highlighter-rouge">foo0.c</code>, <code class="language-plaintext highlighter-rouge">foo1.c</code> và <code class="language-plaintext highlighter-rouge">main.c</code>, tôi muốn build 3 file này thành 1 file thực thi.</p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="c1">// main.c</span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">"foo0.h"</span><span class="cp">
#include</span> <span class="cpf">"foo1.h"</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> 
<span class="p">{</span>
	<span class="n">foo0_func</span><span class="p">();</span>
	<span class="n">foo1_func</span><span class="p">();</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="c1">// foo0.c</span>
<span class="cp">#include</span> <span class="cpf">&lt;foo0.h&gt;</span><span class="cp">
</span><span class="kt">void</span> <span class="nf">foo0_func</span><span class="p">()</span> 
<span class="p">{</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"printf from foo0.c"</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="c1">// foo1.c</span>
<span class="cp">#include</span> <span class="cpf">&lt;foo1.h&gt;</span><span class="cp">
</span><span class="kt">void</span> <span class="nf">foo0_func</span><span class="p">()</span> 
<span class="p">{</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"printf from foo1.c"</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c1">// cùng với 2 file:</span>
<span class="c1">// foo0.h</span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="kt">void</span> <span class="nf">foo0_func</span><span class="p">();</span>

<span class="c1">// foo1.h</span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="kt">void</span> <span class="nf">foo1_func</span><span class="p">();</span>
</pre></table></code></div></div><p><strong>Build các file .c thành .o bằng gcc, link các file .o thành file thực thi</strong></p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">$ </span>gcc foo0.c <span class="nt">-c</span> <span class="c"># biên dịch foo0.c thành foo0.o</span>
<span class="nv">$ </span>gcc foo1.c <span class="nt">-c</span> <span class="c"># biên dịch foo1.c thành foo1.o</span>
<span class="nv">$ </span>gcc main.c <span class="nt">-c</span> <span class="c"># biên dịch main.c thành main.o</span>
<span class="nv">$ </span>gcc main.o foo0.o foo1.o <span class="c"># link các file .o thành file thực thi a.out</span>
</pre></table></code></div></div><p>Mặc định gcc sẽ link 1 file .c thành file thực thi. Cờ -c để gcc biết rằng chỉ cần biên dịch ra file .o mà không cần link thành file thực thi. Nếu không có lỗi gì xảy ra thì 3 file là foo0.o, foo1.o, main.o và a.out sẽ được tạo ra trong thư mục chứa file .c.</p><p>Việc build từng file <code class="language-plaintext highlighter-rouge">.c</code> thành từng file <code class="language-plaintext highlighter-rouge">.o</code> vấp phải một vấn đề triết học mang tên <code class="language-plaintext highlighter-rouge">trứng hay gà</code>. Bởi vì trình biên dịch chỉ biên dịch 1 file mỗi lần, mà trong file đó chứa lời gọi đến hàm trong 1 file .c khác. Cách giải quyết đó là gán một tên ảo cho hàm đó, giả định hàm đó sẽ có đâu đó trong danh sách các hàm trong quá trình link. Hay gọi ngắn là <code class="language-plaintext highlighter-rouge">prototype</code> hay chung quy hơn là <code class="language-plaintext highlighter-rouge">khai báo</code> (declaration).</p><hr /><blockquote><p><strong>Ví dụ khi biên dịch main.c</strong></p><p><code class="language-plaintext highlighter-rouge">main.c </code>chứa 2 lời gọi hàm đó là <code class="language-plaintext highlighter-rouge">foo0_func()</code> và <code class="language-plaintext highlighter-rouge">foo1_func()</code>. Hai hàm này đều nằm trong các file khác, để trình biên dịch biết rằng 2 hàm này nằm ở đâu đó ngoài kia, những vẫn có một điểm nào đó để lời gọi hàm này trỏ tới, ta khai báo 2 hàm này trong <code class="language-plaintext highlighter-rouge">main.c</code>, hay <code class="language-plaintext highlighter-rouge">#include fooX.h</code>. Sau khi biên dịch main.o sẽ có 2 lời gọi <code class="language-plaintext highlighter-rouge">hàm chưa được định nghĩa</code>, đợi đến lúc link, 2 lời gọi hàm này sẽ trỏ tới phần thân hàm trong <code class="language-plaintext highlighter-rouge">fooX.c</code>.</p></blockquote><hr /><p>Để dễ hình dung hơn, bạn có thể dùng <a href="https://linux.die.net/man/1/nm"><code class="language-plaintext highlighter-rouge">nm</code></a> - công cụ để list symbols từ file object (.o). <code class="language-plaintext highlighter-rouge">nm</code> là 1 công cụ trong bộ <a href="https://www.gnu.org/software/binutils/"><code class="language-plaintext highlighter-rouge">binutils</code></a>, rất hữu ích trong việc trích xuất và xem nội dung file thực thi cũng như file object. Chạy <code class="language-plaintext highlighter-rouge">nm main.o foo1.o foo0.o</code> để list các symbol trong 3 file .o trên:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="nv">$ </span>nm main.o foo1.o foo0.o

main.o:
                 U foo0_func
                 U foo1_func
0000000000000000 T main

foo1.o:
0000000000000000 T foo1_func
                 U puts

foo0.o:
0000000000000000 T foo0_func
                 U puts
</pre></table></code></div></div><p>Ta có thể thấy output của <code class="language-plaintext highlighter-rouge">nm</code> chia thành 3 cột: giá trị, loại, tên theo thứ thụ từ trái sang phải. Với output trên, có 2 loại symbol là U và T. U nghĩa là “undefined”, symbol chưa được định nghĩa (hay chưa có thân hàm). T nghĩa là “text”, symbol nằm trong <a href="https://en.wikipedia.org/wiki/Code_segment">.text sections</a>, hay hiểu đơn giản là symbol này là một hàm, giá trị của nó là địa chỉ của hàm.</p><p>Đối với main.o, 2 hàm foo0_func(), foo1_func() chưa được định nghĩa, mong đợi được định nghĩa khi link.</p><p>Đối với <code class="language-plaintext highlighter-rouge">foo0.o</code>, hàm <code class="language-plaintext highlighter-rouge">foo0_func()</code>, đã được định nghĩa nhưng và có giá trị là 0, tức là địa chỉ của hàm <code class="language-plaintext highlighter-rouge">foo0_func()</code> trong <code class="language-plaintext highlighter-rouge">foo0.o</code> là 0. Địa chỉ này sẽ được thay đổi khi các .o link lại với nhau. Hàm <code class="language-plaintext highlighter-rouge">puts()</code> chưa được định nghĩa, vì ta dùng hàm <code class="language-plaintext highlighter-rouge">printf()</code>, <code class="language-plaintext highlighter-rouge">printf()</code> là một hàm wrapper cho <code class="language-plaintext highlighter-rouge">puts()</code>. Hàm <code class="language-plaintext highlighter-rouge">puts()</code> này sẽ được link với thư viện động khi link. Tương tự với <code class="language-plaintext highlighter-rouge">foo1.o</code>.</p><p><strong>Sau khi link thành file thực thi thì có gì ?</strong></p><p>Well, còn tùy thuộc vào nền tảng chạy file thực thi đó mà output của <code class="language-plaintext highlighter-rouge">nm</code> sẽ khác nhau, vì nó sẽ link với thư viện động của hệ điều hành. Ví dụ, tôi đang sử dụng Linux (<code class="language-plaintext highlighter-rouge">Arch Linux</code> btw) và <code class="language-plaintext highlighter-rouge">x86_64-pc-linux-gnu</code> để build thành file <code class="language-plaintext highlighter-rouge">a.out</code> ở trên. Đây là output khi chạy <code class="language-plaintext highlighter-rouge">nm</code> với <code class="language-plaintext highlighter-rouge">a.out</code>:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="nv">$ </span>nm a.out

0000000000003df8 d _DYNAMIC
0000000000004000 d _GLOBAL_OFFSET_TABLE_
0000000000002000 R _IO_stdin_used
                 w _ITM_deregisterTMCloneTable
                 w _ITM_registerTMCloneTable
0000000000002120 r __FRAME_END__
0000000000002030 r __GNU_EH_FRAME_HDR
0000000000004030 D __TMC_END__
000000000000039c r __abi_tag
0000000000004030 B __bss_start
                 w __cxa_finalize@GLIBC_2.2.5
0000000000004020 D __data_start
00000000000010e0 t __do_global_dtors_aux
0000000000003df0 d __do_global_dtors_aux_fini_array_entry
0000000000004028 D __dso_handle
0000000000003de8 d __frame_dummy_init_array_entry
                 w __gmon_start__
                 U __libc_start_main@GLIBC_2.34
0000000000004030 D _edata
0000000000004038 B _end
0000000000001184 T _fini
0000000000001000 T _init
0000000000001040 T _start
0000000000004030 b completed.0
0000000000004020 W data_start
0000000000001070 t deregister_tm_clones
0000000000001139 T foo0_func
000000000000114f T foo1_func
0000000000001130 t frame_dummy
0000000000001165 T main
                 U puts@GLIBC_2.2.5
00000000000010a0 t register_tm_clones
</pre></table></code></div></div><p>Ta có thể thấy một mớ symbol lằng nhằng được thêm vào sau khi link thành file thực thi, những symbol này có liên quan tới trình biên dịch và nền tảng thực thi. Bạn có thể google những symbol lằng nhằng kia nếu tò mò.</p><p><code class="language-plaintext highlighter-rouge">foo0_func</code>, <code class="language-plaintext highlighter-rouge">foo1_func</code>, <code class="language-plaintext highlighter-rouge">main</code> đã có địa chỉ. Tuy nhiên, địa chỉ này chỉ là tương đối, khi thực thi, file thực thi sẽ được load vào ram và sẽ có địa chi <code class="language-plaintext highlighter-rouge">&lt;địa chỉ loader&gt; + &lt;địa chỉ tương đối&gt;</code>.</p><p><strong>Quay về vấn đề chính</strong></p><p>Tôi có thể build nhiều file .c thành 1 file thực thi, thế quái nào tôi lại cần <code class="language-plaintext highlighter-rouge">Makefile</code> làm gì ? Vấn đề, <code class="language-plaintext highlighter-rouge">shell script</code> sẽ chạy từ trên xuống, bất kể file .c có chỉnh sửa chưa, <code class="language-plaintext highlighter-rouge">shell script</code> vẫn sẽ build lại file đó. Hãy tưởng tượng bạn có hàng nghìn file .c, mỗi file build mất 5s, bạn chỉ sửa lại một lỗi nhỏ trong 1 file .c bé tẹo, nhưng phải chờ vài tiếng đồng hồ để build lại cả project. Đó là lúc <code class="language-plaintext highlighter-rouge">Makefile</code> nhảy vào.</p><h2 id="make-makefile-là-gì-"><span class="mr-2">Make, makefile là gì ?</span><a href="#make-makefile-là-gì-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p><code class="language-plaintext highlighter-rouge">Make</code> là công cụ tự động build lại những file .c đã có sự thay đổi. Make có thể sử dụng không chỉ trong lập trình, có thể sử dụng bất cứ đâu mà file output cần phải tự động update khi những file input có sự thay đổi.</p><p>Khi chạy <code class="language-plaintext highlighter-rouge">make</code>, <code class="language-plaintext highlighter-rouge">make</code> sẽ tìm thư mục hiện tại có file tên là <code class="language-plaintext highlighter-rouge">Makefile</code>, <code class="language-plaintext highlighter-rouge">makefile</code> hoặc <code class="language-plaintext highlighter-rouge">GNUmakefile</code> để tìm cách build đã vẽ ra trong những file đó. Nếu không tìm thấy <code class="language-plaintext highlighter-rouge">makefile</code> nào, <code class="language-plaintext highlighter-rouge">make</code> sẽ mặc định chạy <em>implicit rule</em>.</p><p>Nếu bạn cảm thấy bài post này chán, nhưng vẫn muốn tìm hiểu vê <code class="language-plaintext highlighter-rouge">make</code>, here you go, <a href="https://www.gnu.org/software/make/manual/make.html">make</a>.</p><h2 id="rules"><span class="mr-2">Rules</span><a href="#rules" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Rule có dạng:</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nl">target … </span><span class="o">:</span> <span class="nf">prerequisites …</span>
        <span class="err">recipe</span>
        <span class="err">…</span>
        <span class="err">…</span>
</pre></table></code></div></div><ul><li><em>target</em> thông thường là file, được tạo ra khi rule này chạy, giống kiểu output.<li><em>prerequisites</em> là một hoặc nhiều file input cần để tạo ra file target.<li><em>recipe</em> là hành động tạo ra file target, có thể là một lệnh hoặc nhiều lệnh, trên cùng một dòng hoặc nhiều dòng. <strong>Lưu ý:</strong> Cần phải đặt một dấu <code class="language-plaintext highlighter-rouge">tab</code> trước môi dòng recipe, thì make mới hiểu đó là dòng recipe.</ul><p>Thông thường, recipe trong rule sẽ thực thi, để tạo ra target, khi có bất cứ file nào thay đổi ở prerequisites. Rule có thể có prerequisites hoặc không.</p><p>Rule giải thích cho make,</p><ul><li>khi nào cần build lại file target (prerequisites)<li>và làm sao build được nó (recipe)</ul><p>Đơn giản, recipe sẽ chạy khi rule có:</p><ul><li>target chưa tồn tại, prerequisites tồn tại, trường hợp này target sẽ được <strong>tạo ra</strong>,<li>target tồn tại, prerequisites bị thay đổi, trường hợp này target cần <strong>update</strong>.</ul><p>Quay lại với vấn đề build 3 file <code class="language-plaintext highlighter-rouge">foo0.c</code>, <code class="language-plaintext highlighter-rouge">foo1.c</code>, <code class="language-plaintext highlighter-rouge">main.c</code>. Tôi có makefile mẫu:</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="c"># Thêm foo0.h và foo1.h để chắc chắn 2 file này tồn tại để 
# main.c có thể include được. 2 file này có thể thêm vào prerequisites
# hoặc không
</span><span class="nl">main.o</span><span class="o">:</span> <span class="nf">main.c foo0.h foo1.h </span>
	gcc main.c <span class="nt">-o</span> main.o <span class="nt">-c</span>

<span class="nl">foo0.o</span><span class="o">:</span> <span class="nf">foo0.c foo0.h</span>
	gcc foo0.c <span class="nt">-o</span> foo0.o <span class="nt">-c</span>

<span class="nl">foo1.o</span><span class="o">:</span> <span class="nf">foo1.c foo1.h</span>
	gcc foo1.c <span class="nt">-o</span> foo1.o <span class="nt">-c</span>

<span class="c"># Linking
</span><span class="nl">example.elf</span><span class="o">:</span> <span class="nf">main.o foo0.o foo1.o</span>
	gcc main.o foo0.o foo1.o
</pre></table></code></div></div><p>Khi chạy <code class="language-plaintext highlighter-rouge">make example.elf</code>:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nv">$ </span>make example.elf 

gcc main.c <span class="nt">-o</span> main.o <span class="nt">-c</span>
gcc foo0.c <span class="nt">-o</span> foo0.o <span class="nt">-c</span>
gcc foo1.c <span class="nt">-o</span> foo1.o <span class="nt">-c</span>
gcc main.o foo0.o foo1.o <span class="nt">-o</span> example.elf
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">Make</code> sẽ tìm tới rule <code class="language-plaintext highlighter-rouge">example.elf</code>, tìm 3 file prerequisites, nếu 3 file đó chưa được tạo ra thì tìm tới từng rule để tạo ra file đó. Giả sử <code class="language-plaintext highlighter-rouge">main.o</code>, make sẽ tìm tới rule <code class="language-plaintext highlighter-rouge">main.o</code>, kiểm tra <code class="language-plaintext highlighter-rouge">prerequisites</code>, nếu có đủ, chạy recipe, sau khi chạy xong sẽ trở về rule <code class="language-plaintext highlighter-rouge">example.elf</code>, kiểm tra prerequisites tiếp theo là foo0.o, cứ tiếp tục như vậy đến khi prerequisites có đủ các file thì recipe của rule <code class="language-plaintext highlighter-rouge">example.elf</code> sẽ chạy để tạo ra <code class="language-plaintext highlighter-rouge">example.elf</code>.</p><h3 id="pattern-rules"><span class="mr-2">Pattern Rules</span><a href="#pattern-rules" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p><code class="language-plaintext highlighter-rouge">Makefile</code> ở trên có thể viết gọn hơn dùng Pattern Rules:</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nl">%.o</span><span class="o">:</span> <span class="nf">%.c</span>
	gcc <span class="nv">$^</span> <span class="nt">-o</span> <span class="nv">$@</span> <span class="nt">-c</span>

<span class="c"># Linking
</span><span class="nl">example.elf</span><span class="o">:</span> <span class="nf">main.o foo0.o foo1.o</span>
	gcc main.o foo0.o foo1.o
</pre></table></code></div></div><p>Bất cứ khi nào prerequisites của rule nào đó match với target của pattern rule, thì pattern rule sẽ được thực thi với <code class="language-plaintext highlighter-rouge">%</code> là phần còn lại không match sẽ thay thế target và prerequisites. Ví dụ, khi rule example.elf được thực thi, nó tìm main.o, main.o match với <code class="language-plaintext highlighter-rouge">%.o: %.c</code> lúc này pattern rule sẽ trở thành <code class="language-plaintext highlighter-rouge">main.o: main.c</code>.</p><p><code class="language-plaintext highlighter-rouge">$^</code> là <code class="language-plaintext highlighter-rouge">biến tự động</code> chứa tên của tất cả prerequisites. <code class="language-plaintext highlighter-rouge">$@</code> là <code class="language-plaintext highlighter-rouge">biến tự động</code> chứa tên của target. Ngoài ra còn có <code class="language-plaintext highlighter-rouge">$&lt;</code> chứa tên của một prerequisites đầu tiên. Ví dụ: khi match với main.o thì pattern rule sẽ giống như này:</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nl">main.o</span><span class="o">:</span> <span class="nf">main.c</span>
	gcc main.c <span class="nt">-o</span> main.o <span class="nt">-c</span>
</pre></table></code></div></div><p>Việc sử dụng pattern rule giúp makefile đơn giản hơn và dễ quản lí. Mặc định, <code class="language-plaintext highlighter-rouge">%.o: %.c</code> là một trong số những Implicit Rule tích hợp sẵn trong make (xem ví dụ 2 Implicit Rule).</p><h3 id="implicit-rule"><span class="mr-2">Implicit rule</span><a href="#implicit-rule" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p><strong>Ví dụ 1:</strong></p><p>Thông thường khi chạy make mà không có <code class="language-plaintext highlighter-rouge">makefile</code>, make sẽ dùng <em>Implicit rule</em>. Rất hữu ích khi muốn build nhanh một file .c thành file thực thi.</p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"Test make"</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Lưu file với tên test.c trong một thư mục không có <em>Makefile</em>. Chạy <code class="language-plaintext highlighter-rouge">make test</code>:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span>make <span class="nb">test

</span>cc     test.c   <span class="nt">-o</span> <span class="nb">test</span>
</pre></table></code></div></div><p>File thực thi <code class="language-plaintext highlighter-rouge">test</code> sẽ được tạo ra. <code class="language-plaintext highlighter-rouge">cc test.c -o test</code> là dòng ngầm định khi build không có makefile. <code class="language-plaintext highlighter-rouge">cc</code> là một symlink tới <code class="language-plaintext highlighter-rouge">gcc</code>, về cơ bản là giống nhau. Để sửa <code class="language-plaintext highlighter-rouge">cc</code> thành <code class="language-plaintext highlighter-rouge">gcc</code> hay thêm flag để dòng ngầm định trên trở thành <code class="language-plaintext highlighter-rouge">gcc -g test.c -o test</code> chẳng hạn thì ta chỉ cần gán cho các biến ngầm định như CC và CFLAGS:</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">CC</span> <span class="o">=</span> gcc
<span class="nv">CFLAGS</span> <span class="o">=</span> <span class="nt">-g</span>
</pre></table></code></div></div><p>Output khi chạy <code class="language-plaintext highlighter-rouge">make test</code> với <code class="language-plaintext highlighter-rouge">makefile</code> trên:</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span>make <span class="nb">test

</span>gcc <span class="nt">-g</span>    test.c   <span class="nt">-o</span> <span class="nb">test</span>
</pre></table></code></div></div><p>Bạn có thể tra các biến ngầm định tại <a href="https://www.gnu.org/software/make/manual/make.html#Implicit-Variables">đây</a></p><p><strong>Ví dụ 2:</strong></p><p>Giả sử, ta có makefile:</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nl">example.elf</span><span class="o">:</span> <span class="nf">main.o foo1.o foo2.o</span>
	gcc <span class="nv">$^</span> <span class="nt">-o</span> example.elf
</pre></table></code></div></div><p>Ta không viết rule nào cho <code class="language-plaintext highlighter-rouge">main.o</code>, nhưng makefile sẽ tự động tìm <em>implicit rule</em> cho main.o. Việc chỉnh sửa recipe cho <em>implicit rule</em> này dựa vào <em>implicit variable</em> giống như ví dụ 1. Để biết các <em>implicit rule</em> và cách sắp xếp của <em>implicit variable</em> trong <em>implicit rule</em> ban có thể tra ở <a href="https://www.gnu.org/software/make/manual/html_node/Catalogue-of-Rules.html#Catalogue-of-Rules">đây</a></p><h2 id="phony-target"><span class="mr-2">Phony target</span><a href="#phony-target" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Phony target chỉ là một cái tên để luôn chạy recipe mỗi khi được gọi, không nhất thiết là một file cần được tạo ra.</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nl">clean</span><span class="o">:</span> 
	<span class="nb">rm</span> <span class="nt">-rf</span> <span class="p">$(</span>OBJS<span class="p">)</span> example.elf
</pre></table></code></div></div><p>Trong ví dụ trên, môi khi chạy <code class="language-plaintext highlighter-rouge">make clean</code>, thì recipe sẽ luôn chay. Nhưng trên đường đời tấp nập ta vô tình tạo ra một file tên <code class="language-plaintext highlighter-rouge">clean</code> thì make file kiểm tra thư mục hiện tai (<a href="https://en.wikipedia.org/wiki/Working_directory">working directory</a>) có file clean đã được tạo ra và do không có dependency nên file này đuoc coi như là đã update nên recipe của rule này sẽ không chạy nếu ta chạy <code class="language-plaintext highlighter-rouge">make clean</code>. Để khắc phục vấn để này, để recipe này luôn luôn chạy mỗi khi <code class="language-plaintext highlighter-rouge">make clean</code> thì ta dùng phony target:</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nl">.PHONY</span><span class="o">:</span> <span class="nf">clean</span>
<span class="nl">clean</span><span class="o">:</span> 
	<span class="nb">rm</span> <span class="nt">-rf</span> <span class="p">$(</span>OBJS<span class="p">)</span> example.elf
</pre></table></code></div></div><h2 id="makefile-hoàn-chỉnh"><span class="mr-2">Makefile hoàn chỉnh</span><a href="#makefile-hoàn-chỉnh" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Thông thường, để quản lí project, makefile chỉ cần viết một lần. Các khi thêm một module vào project, ta chỉ cần sửa makefile thêm đường dẫn tới file .c bằng biến <code class="language-plaintext highlighter-rouge">SRCS</code>. Các file .o sau khi build sẽ lưu ở một thư mục khác (e.g. build, obj). Dưới đây là makefile mẫu cho một project C:</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="nv">CFLAGS</span>	<span class="o">=</span><span class="nt">-g</span> <span class="nt">-O0</span>
<span class="nv">CC</span> 	<span class="o">=</span> gcc
<span class="nv">SRCS</span>	<span class="o">=</span> main.c foo0.c foo1.c
<span class="nv">OBJS</span>	<span class="o">=</span> <span class="p">$(</span>patsubst %.c, %.o, <span class="p">$(</span>SRCS<span class="p">))</span> <span class="c"># chuyển suffix .c thành .o: OBJS = main.o foo.o foo1.o</span>

<span class="nl">.PHONY</span><span class="o">:</span> <span class="nf">all clean</span>

<span class="nl">all</span><span class="o">:</span> <span class="nf">example.elf </span><span class="c">#</span><span class="nf"> make se mặc định chạy example.elf</span>

<span class="nl">example.elf</span><span class="o">:</span> <span class="nf">$(OBJS)</span>
	<span class="p">$(</span>CC<span class="p">)</span> <span class="p">$(</span>CFLAGS<span class="p">)</span> <span class="nv">$^</span> <span class="nt">-o</span> <span class="nv">$@</span>

<span class="c"># Implicit Rule, cái này có hay không cũng được, nhung ngầm đinh nó sẽ như thế này:
# %.o: %.c #
# 	$(CC) -c $(CFLAGS) $(CPPFLAGS) -o $@ $&lt;
</span>
<span class="nl">clean</span><span class="o">:</span> 
	<span class="nb">rm</span> <span class="nt">-rf</span> <span class="p">$(</span>OBJS<span class="p">)</span> example.elf

</pre></table></code></div></div><h2 id="một-số-preset-build-makefile-link-với-a-code-không-có-hàm-main"><span class="mr-2">Một số preset build makefile link với .a (code không có hàm <code class="language-plaintext highlighter-rouge"><span class="mr-2">main()</code>)</span><a href="#một-số-preset-build-makefile-link-với-a-code-không-có-hàm-main" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Với kiểu build này, người lập trình sẽ code trong một hoặc nhiều hàm, có flow khác với kiểu code trong main() truyền thống. Ví du tiêu biểu nhất là Arduino IDE, người lập trình sẽ code trong setup() và loop(), khi chương trình bắt đầu, sau khi chạy startup (của trình biên dịch), chương trình nhảy vào setup() 1 lần, sau đó nhảy vào một vòng lặp và lặp loop() đến chết. RTOS, SDK của xtensa cho esp8266 cũng theo kiểu này.</p><p>Mục đích của kiểu link này là đê giấu phần code của hệ thống đi, chỉ để lại phần usercode và API cho người dùng gọi tới. Phần API, system flow sẽ được build trong file .a kia, còn phần usercode sẽ được viết trong 1 vài hàm, khi system flow gọi tới hàm trong usercode thì phần code đó sẽ được thực thi.</p><p>Dưới đây là makefile cho esp8266 với esp8266 non-os SDK, build trên wsl-ubuntu:</p><div class="language-makefile highlighter-rouge"><div class="code-header"> <span data-label-text="Makefile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre><td class="rouge-code"><pre><span class="nv">XTENSA</span>		<span class="o">?=</span>

<span class="c"># Mac and linux
</span><span class="nv">SDK_BASE</span>	<span class="o">?=</span> /mnt/c/otp/Espressif/ESP8266_NONOS_SDK
<span class="nv">ESPTOOL</span>		<span class="o">?=</span> /mnt/c/otp/Espressif/utils/esptool/esptool.py

<span class="c"># Windows with unofficial dev kit (default install location is C:/Espressif)
</span> <span class="nv">SDK_BASE_WIN</span>	<span class="o">?=</span> C:/otp/Espressif/ESP8266_NONOS_SDK
 <span class="nv">ESPTOOL_WIN</span>	<span class="o">?=</span> C:/otp/Espressif/utils/esptool/esptool.py

<span class="nv">SDK_LIBS</span> 	<span class="o">:=</span> <span class="nt">-lc</span> <span class="nt">-lgcc</span> <span class="nt">-lhal</span> <span class="nt">-lphy</span> <span class="nt">-lpp</span> <span class="nt">-lnet80211</span> <span class="nt">-lwpa</span> <span class="nt">-lmain</span> <span class="nt">-llwip</span> <span class="nt">-lcrypto</span> <span class="nt">-ljson</span>
<span class="nv">CC</span>			<span class="o">:=</span> <span class="p">$(</span>XTENSA<span class="p">)</span>xtensa-lx106-elf-gcc
<span class="nv">LD</span>			<span class="o">:=</span> <span class="p">$(</span>XTENSA<span class="p">)</span>xtensa-lx106-elf-gcc
<span class="nv">AR</span>			<span class="o">:=</span> <span class="p">$(</span>XTENSA<span class="p">)</span>xtensa-lx106-elf-ar

<span class="nv">LDFLAGS</span>		<span class="o">=</span> <span class="nt">-nostdlib</span> <span class="nt">-Wl</span>,--no-check-sections <span class="nt">-u</span> call_user_start <span class="nt">-Wl</span>,-static <span class="nt">-Xlinker</span> <span class="nt">-Map</span><span class="o">=</span>esp.map
<span class="nv">CFLAGS</span> 		<span class="o">=</span> <span class="nt">-g</span> <span class="nt">-Wpointer-arith</span> <span class="nt">-Wundef</span> <span class="nt">-Wl</span>,-EL <span class="nt">-fno-inline-functions</span> <span class="nt">-nostdlib</span><span class="se">\</span>
			  <span class="nt">-mlongcalls</span> <span class="nt">-mtext-section-literals</span> <span class="nt">-ffunction-sections</span> <span class="nt">-fdata-sections</span><span class="se">\</span>
			  <span class="nt">-fno-builtin-printf</span> <span class="nt">-DICACHE_FLASH</span><span class="se">\</span>
			  <span class="nt">-I</span>.
<span class="nv">LD_SCRIPT</span>	<span class="o">=</span> <span class="nt">-T</span><span class="p">$(</span>SDK_BASE<span class="p">)</span>/ld/eagle.app.v6.ld

<span class="nl">all</span><span class="o">:</span> <span class="nf">main.bin</span>

<span class="nl">main.bin</span><span class="o">:</span> <span class="nf">main.out</span>
	xtensa-lx106-elf-objdump <span class="nt">-S</span> <span class="nv">$&lt;</span> <span class="o">&gt;</span> esp.lss
	<span class="p">$(</span>ESPTOOL<span class="p">)</span> elf2image <span class="p">$(</span>ESPTOOL_FLASHDEF<span class="p">)</span> main.out <span class="nt">-o</span> main
	
<span class="nl">main.out</span><span class="o">:</span> <span class="nf">main.a</span>
	<span class="p">@</span><span class="nb">echo</span> <span class="s2">"LD </span><span class="nv">$@</span><span class="s2">"</span>
	<span class="p">$(</span>LD<span class="p">)</span> <span class="nt">-L</span><span class="p">$(</span>SDK_BASE<span class="p">)</span>/lib <span class="p">$(</span>LD_SCRIPT<span class="p">)</span> <span class="p">$(</span>LDFLAGS<span class="p">)</span> <span class="nt">-L</span><span class="p">$(</span>SDK_BASE<span class="p">)</span>/lib <span class="nt">-Wl</span>,--start-group <span class="p">$(</span>SDK_LIBS<span class="p">)</span> main.a <span class="nt">-Wl</span>,--end-group <span class="nt">-o</span> main.out

<span class="nl">main.a</span><span class="o">:</span> <span class="nf">main.o</span>
	<span class="p">@</span><span class="nb">echo</span> <span class="s2">"AR main.o"</span>
	<span class="p">$(</span>AR<span class="p">)</span> cru main.a main.o rf_init.o
	
<span class="nl">main.o</span><span class="o">:</span>
	<span class="p">@</span><span class="nb">echo</span> <span class="s2">"CC main.c &amp; rf_init.c"</span>
	<span class="p">$(</span>CC<span class="p">)</span> <span class="nt">-I</span><span class="s1">'</span><span class="p">$(</span><span class="s1">SDK_BASE</span><span class="p">)</span><span class="s1">/include/'</span> <span class="p">$(</span>CFLAGS<span class="p">)</span> <span class="nt">-c</span> main.c <span class="nt">-o</span> main.o
	<span class="p">$(</span>CC<span class="p">)</span> <span class="nt">-I</span><span class="s1">'</span><span class="p">$(</span><span class="s1">SDK_BASE</span><span class="p">)</span><span class="s1">/include/'</span> <span class="p">$(</span>CFLAGS<span class="p">)</span> <span class="nt">-c</span> rf_init.c <span class="nt">-o</span> rf_init.o
	
<span class="nl">clean</span><span class="o">:</span>
	<span class="nb">rm</span> <span class="nt">-rf</span> <span class="k">*</span>.o <span class="k">*</span>.bin <span class="k">*</span>.a <span class="k">*</span>.out

<span class="nl">flash</span><span class="o">:</span>
	python.exe <span class="p">$(</span>ESPTOOL_WIN<span class="p">)</span> <span class="nt">--port</span> <span class="se">\\\\</span>.<span class="se">\\</span>COM3 <span class="se">\</span>
			   <span class="nt">--baud</span> 480600 <span class="se">\</span>
			   write_flash <span class="nt">--flash_freq</span> 40m <span class="nt">--flash_mode</span> dio <span class="nt">--flash_size</span> 32m <span class="se">\</span>
			   0x00000 main0x00000.bin <span class="se">\</span>
			   0x10000 main0x10000.bin <span class="se">\</span>
			   0x3fc000 <span class="p">$(</span>SDK_BASE_WIN<span class="p">)</span>/bin/esp_init_data_default.bin

<span class="nl">.PHONY</span><span class="o">:</span> <span class="nf">all clean</span>
</pre></table></code></div></div><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="c1">// main.c</span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">"osapi.h"</span><span class="cp">
#include</span> <span class="cpf">"user_interface.h"</span><span class="cp">
</span><span class="k">static</span> <span class="n">os_timer_t</span> <span class="n">led_timer</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">led_value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">app_init</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">os_printf</span><span class="p">(</span><span class="s">"Helloo blahbla</span><span class="se">\r\n</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">user_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">system_init_done_cb</span><span class="p">(</span><span class="n">app_init</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><blockquote><p>Makefile tôi lấy từ 1 project có sẵn, có file rf_init.c nữa nhưng tôi không thêm vào để đỡ rối.</p></blockquote><p>Ở <code class="language-plaintext highlighter-rouge">main.out:</code> main.a sẽ được link với <code class="language-plaintext highlighter-rouge">-lc -lgcc -lhal -lphy -lpp -lnet80211 -lwpa -lmain -llwip -lcrypto -ljson</code>. Sau đó được trích thành file .bin bằng esptool.py.</p><h2 id="kết-luận"><span class="mr-2">Kết luận</span><a href="#kết-luận" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Trên đây là kiến thức cơ bản Makefile cho những người mới bắt đầu, nếu bạn đọc tới đây thì bạn có thể tao bất kì project nào với Makefile kể từ bây giờ, không chỉ là code mà bât cứ project nào có dependency file.</p><p>Bởi vì giới hạn về thời gian nên bài viết còn rât nhiều thiếu sót, bài viết này cần feedback để hoàn thiện hơn. Feel free to leave comments, tôi sẽ giải đáp thắc mắc và tiếp thu ý kiến từ bạn.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/build-system/'>build-system</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/makefile/" class="post-tag no-text-decoration" >makefile</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Makefile tiếng Việt - Kien&#39;s Lab&amp;url=https://www.kienlab.com/posts/makefile-tieng-viet-101/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Makefile tiếng Việt - Kien&#39;s Lab&amp;u=https://www.kienlab.com/posts/makefile-tieng-viet-101/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://www.kienlab.com/posts/makefile-tieng-viet-101/&amp;text=Makefile tiếng Việt - Kien&#39;s Lab" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div><div class="comment-section"><h4>LEAVE A COMMENT</h4><script src="https://utteranc.es/client.js" repo="kienvo/kienvo.github.io" issue-term="pathname" label="comment on post:" theme="github-dark" crossorigin="anonymous" async> </script></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/windows-qt5-deploy-static-linking-msys2/">Windows Qt application deployment with static linking</a><li><a href="/posts/makefile-tieng-viet-101/">Makefile tiếng Việt</a><li><a href="/posts/cross-compiling-kernel-modules/">Cross compiling kernel modules</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/arm/">arm</a> <a class="post-tag" href="/tags/console/">console</a> <a class="post-tag" href="/tags/cross-compile/">cross-compile</a> <a class="post-tag" href="/tags/driver/">driver</a> <a class="post-tag" href="/tags/kernel/">kernel</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/makefile/">makefile</a> <a class="post-tag" href="/tags/modules/">modules</a> <a class="post-tag" href="/tags/msys2/">msys2</a> <a class="post-tag" href="/tags/qt/">qt</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/windows-qt5-deploy-static-linking-msys2/"><div class="card-body"> <em class="timeago small" data-ts="1667538000" > 2022-11-04 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Windows Qt application deployment with static linking</h3><div class="text-muted small"><p> The problem Deployment might be an unnecessary activity when developing softwares. It been a long time since I started to learn programming, I only make for myself softwares which would be abandon...</p></div></div></a></div><div class="card"> <a href="/posts/rpi3b+undervoltage-uart-console/"><div class="card-body"> <em class="timeago small" data-ts="1665464400" > 2022-10-11 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Lỗi console uart trên rpi3b+</h3><div class="text-muted small"><p> Lỗi Khi sử dụng rpi3b+ với nguồn usb laptop hoặc mấy loại củ sạc dỏm thì console uart của rpi bị nhảy kí tự, không thể đánh lệnh hoặc không thể đọc được. Nguyên nhân Mấy củ sạc dỏm hay nguồn us...</p></div></div></a></div><div class="card"> <a href="/posts/cross-compiling-kernel-modules/"><div class="card-body"> <em class="timeago small" data-ts="1637249220" > 2021-11-18 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Cross compiling kernel modules</h3><div class="text-muted small"><p> Just got to compile a driver for ti-ads1220 running with Orange Pi Zero. I’ve figure out some stuff when digging to kernel modules. Below is how I config cross build for my Pi. Target system Or...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/cross-compiling-kernel-modules/" class="btn btn-outline-primary" prompt="Older"><p>Cross compiling kernel modules</p></a> <a href="/posts/rpi3b+undervoltage-uart-console/" class="btn btn-outline-primary" prompt="Newer"><p>Lỗi console uart trên rpi3b+</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/username">kienvo</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/arm/">arm</a> <a class="post-tag" href="/tags/console/">console</a> <a class="post-tag" href="/tags/cross-compile/">cross-compile</a> <a class="post-tag" href="/tags/driver/">driver</a> <a class="post-tag" href="/tags/kernel/">kernel</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/makefile/">makefile</a> <a class="post-tag" href="/tags/modules/">modules</a> <a class="post-tag" href="/tags/msys2/">msys2</a> <a class="post-tag" href="/tags/qt/">qt</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-YQWD2MKFXS"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-YQWD2MKFXS'); }); </script>
